<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="plan">

    <insert id="insertPlan" parameterType="Plan">
        insert into plan (username, title, departure, days, plans)
        values (#{username}, #{title}, #{departure}, #{days}, #{plans})
    </insert>

    <select id="getPlanByIdx" parameterType="_int" resultType="Plan">
        select *
        from plan
        where idx = #{idx}
    </select>

    <select id="getPlansByUser" parameterType="string" resultType="Plan">
        select *
        from plan
        where username = #{username}
        order by regdate desc
    </select>

    <select id="getAllPlansList" parameterType="PageInfo" resultType="Plan">
        <![CDATA[
        select *
        from (
                 SELECT a.*, ROWNUM as rnum
                 FROM (
                          SELECT *
                          FROM plan
                          ORDER BY regdate desc) a)
        WHERE rnum >= #{startRow}
          and rnum <= #{endRow}
        ]]>
    </select>

    <select id="getAllPlansCount" resultType="_int">
        select count(*)
        from plan
        where pub = 0
    </select>

    <update id="updatePlan" parameterType="Plan">
        update plan
        set title=#{title},
            days=#{days},
            plans=#{plans}
        where idx = #{idx}
    </update>

    <delete id="deletePlan" parameterType="_int">
        delete
        from plan
        where idx =
              #{idx}
    </delete>

</mapper>